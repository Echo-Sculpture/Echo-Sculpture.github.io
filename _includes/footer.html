<div class="page__footer-copyright">
  &copy; {{ site.time | date: '%Y' }} {{ site.name | default: site.title }}
</div>

<style>
  /* 强制画布全屏、置底、可见 */
  #p5-canvas {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: -1 !important;
    background: #000 !important; /* 强制背景黑色，能看到它就说明加载成功 */
  }
  /* 强制所有上层容器透明 */
  html, body, #main, .wrapper, .page__inner-wrap {
    background: transparent !important;
  }
</style>

{% raw %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
<script>
  // 使用最基础的 JavaScript 语法，避免任何可能引起歧义的符号
  var mic, fft;
  var isStarted = false;

  function setup() {
    var cnv = createCanvas(windowWidth, windowHeight);
    cnv.id('p5-canvas');
    cnv.parent(document.body);
    
    // 初始化颜色模式
    colorMode(HSB, 360, 100, 100);
    console.log("P5 initialized");
  }

  function draw() {
    background(0, 0, 10); // 深色背景

    if (!isStarted) {
      fill(255);
      textAlign(CENTER);
      text("CLICK TO ACTIVATE VISUALIZER", width/2, height/2);
    } else {
      // 绘制简单的动态方块作为测试
      for (var i = 0; i < 10; i++) {
        var h = (frameCount + i * 20) % 360;
        fill(h, 80, 100);
        rect(i * 100, height/2 + sin(frameCount * 0.05 + i) * 100, 80, 80);
      }
    }
  }

  function mousePressed() {
    if (!isStarted) {
      // 激活音频
      if (typeof p5.AudioIn !== 'undefined') {
        mic = new p5.AudioIn();
        mic.start();
        fft = new p5.FFT();
        fft.setInput(mic);
      }
      isStarted = true;
      console.log("Audio enabled");
    }
  }

  function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
  }
</script>
{% endraw %}
